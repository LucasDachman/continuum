{"ast":null,"code":"import _slicedToArray from \"/Users/lucas/fall-2019/capstone/continuum-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/lucas/fall-2019/capstone/continuum-app/client/src/components/Synth1/Synth1.jsx\";\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { connect } from 'react-redux';\nimport CSynth from '../../audio/CSynth';\nimport { subscribeCSynth } from '../../redux/subscriptions';\nimport { setAmp, setFilter } from '../../redux/reducers/synth1UIReducer';\nimport Dial from '../util/Dial';\nconst Nexus = window.Nexus;\nconst mtof = Nexus.mtof;\nconst lowNote = 24;\nconst highNote = 72;\nconst tickTime = 170;\nconst frequencyOffsetValues = new Array(7).fill(null).map((_, i) => String(i - 3));\nconst mapDispatch = {\n  setAmp,\n  setFilter\n};\n\nconst mapStateToProps = state => ({\n  amp: state.synth1UI.amp,\n  filter: state.synth1UI.filter\n});\n\nconst useSetCallback = (set, attr) => {\n  return useCallback(v => set({\n    [attr]: v\n  }), [set, attr]);\n};\n\nconst Synth1 = ({\n  isPlaying,\n  setAmp,\n  setFilter,\n  amp,\n  filter\n}) => {\n  // const [val, setVal] = useState(null);\n  const _useState = useState('0'),\n        _useState2 = _slicedToArray(_useState, 2),\n        frequencyOffset = _useState2[0],\n        setFrequencyOffset = _useState2[1];\n\n  const handleClickFrequencyOffset = e => {\n    synth.current.frequencyOffset = Number(e.currentTarget.value);\n    setFrequencyOffset(e.currentTarget.value);\n  };\n\n  const synth = useRef();\n  useEffect(() => {\n    if (!synth.current) return;\n    isPlaying ? synth.current.start() : synth.current.stop();\n  }, [isPlaying, synth]); // runs when audio context has started\n\n  useEffect(() => {\n    // if (!audioContextStarted) return;\n    synth.current = new CSynth(tickTime);\n    const synthRef = synth.current;\n    subscribeCSynth(synthRef);\n    const sequencer = new Nexus.Sequencer('#sequencer', {\n      rows: 24,\n      columns: 16\n    });\n    sequencer.on('change', ({\n      row,\n      column,\n      state\n    }) => {\n      window.localStorage.setItem('chords', JSON.stringify(sequencer.matrix.pattern));\n      const freq = mtof(lowNote - row + 24);\n\n      if (state) {\n        synthRef.addNote({\n          index: column,\n          freq\n        });\n      } else {\n        synthRef.removeNote({\n          index: column,\n          freq\n        });\n      }\n    });\n    const localChords = window.localStorage.getItem('chords');\n\n    if (localChords) {\n      sequencer.matrix.set.all(JSON.parse(localChords));\n    }\n\n    synthRef.onTick = pos => {\n      sequencer.stepper.value = pos;\n      sequencer.next();\n    };\n  }, []); // actual render code\n\n  console.log(useSetCallback(setAmp, 'attack'));\n  return React.createElement(\"div\", {\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }, React.createElement(\"section\", {\n    id: \"amp-env\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85\n    },\n    __self: this\n  }, \"Amp Env\"), React.createElement(\"div\", {\n    className: \"knob-row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: amp.attack,\n    onChange: useSetCallback(setAmp, 'attack'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88\n    },\n    __self: this\n  }), \"Attack\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: amp.decay,\n    onChange: useSetCallback(setAmp, 'decay'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }), \"Decay\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: amp.sustain,\n    onChange: useSetCallback(setAmp, 'sustain'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }), \"Sustain\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: amp.release,\n    onChange: useSetCallback(setAmp, 'release'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }), \"Release\"))), React.createElement(\"section\", {\n    id: \"filter-env\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }, \"Filter\"), React.createElement(\"div\", {\n    className: \"knob-row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: filter.attack,\n    onChange: useSetCallback(setFilter, 'attack'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  }), \"Attack\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: filter.decay,\n    onChange: useSetCallback(setFilter, 'decay'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }), \"Decay\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: filter.sustain,\n    onChange: useSetCallback(setFilter, 'sustain'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }), \"Sustain\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: filter.release,\n    onChange: useSetCallback(setFilter, 'release'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }), \"Release\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: filter.base,\n    onChange: useSetCallback(setFilter, 'base'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  }), \"Base\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: filter.range,\n    onChange: useSetCallback(setFilter, 'range'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }), \"Range\"), React.createElement(\"div\", {\n    className: \"knob\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, React.createElement(Dial, {\n    value: filter.q,\n    onChange: useSetCallback(setFilter, 'q'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }), \"Q\"))), React.createElement(\"form\", {\n    id: \"frequency-offset\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }, React.createElement(\"h3\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150\n    },\n    __self: this\n  }, \"Frequency Offset\"), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, frequencyOffsetValues.map(value => {\n    return React.createElement(\"input\", {\n      type: \"radio\",\n      name: \"frequency-offset\",\n      value: value,\n      key: value,\n      checked: frequencyOffset === value,\n      onChange: handleClickFrequencyOffset,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    });\n  }))), React.createElement(\"div\", {\n    id: \"sequencer\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }));\n};\n\nexport default connect(mapStateToProps, mapDispatch)(Synth1);","map":{"version":3,"sources":["/Users/lucas/fall-2019/capstone/continuum-app/client/src/components/Synth1/Synth1.jsx"],"names":["React","useState","useEffect","useRef","useCallback","connect","CSynth","subscribeCSynth","setAmp","setFilter","Dial","Nexus","window","mtof","lowNote","highNote","tickTime","frequencyOffsetValues","Array","fill","map","_","i","String","mapDispatch","mapStateToProps","state","amp","synth1UI","filter","useSetCallback","set","attr","v","Synth1","isPlaying","frequencyOffset","setFrequencyOffset","handleClickFrequencyOffset","e","synth","current","Number","currentTarget","value","start","stop","synthRef","sequencer","Sequencer","rows","columns","on","row","column","localStorage","setItem","JSON","stringify","matrix","pattern","freq","addNote","index","removeNote","localChords","getItem","all","parse","onTick","pos","stepper","next","console","log","attack","decay","sustain","release","base","range","q"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { connect } from 'react-redux';\nimport CSynth from '../../audio/CSynth';\nimport { subscribeCSynth } from '../../redux/subscriptions';\nimport { setAmp, setFilter } from '../../redux/reducers/synth1UIReducer';\nimport Dial from '../util/Dial';\n\nconst Nexus = window.Nexus;\nconst { mtof } = Nexus;\n\nconst lowNote = 24;\nconst highNote = 72;\nconst tickTime = 170;\n\nconst frequencyOffsetValues = new Array(7).fill(null).map((_, i) => String(i - 3));\n\nconst mapDispatch = {\n  setAmp,\n  setFilter\n};\n\nconst mapStateToProps = state => ({\n  amp: state.synth1UI.amp,\n  filter: state.synth1UI.filter,\n});\n\nconst useSetCallback = (set, attr) => {\n  return useCallback(v => set({ [attr]: v }), [set, attr]);\n}\n\nconst Synth1 = ({ isPlaying, setAmp, setFilter, amp, filter }) => {\n\n  // const [val, setVal] = useState(null);\n  const [frequencyOffset, setFrequencyOffset] = useState('0');\n\n  const handleClickFrequencyOffset = e => {\n    synth.current.frequencyOffset = Number(e.currentTarget.value);\n    setFrequencyOffset(e.currentTarget.value);\n  }\n\n  const synth = useRef();\n\n  useEffect(() => {\n    if (!synth.current) return;\n    isPlaying ? synth.current.start() : synth.current.stop();\n  }, [isPlaying, synth])\n\n\n  // runs when audio context has started\n  useEffect(() => {\n    // if (!audioContextStarted) return;\n    synth.current = new CSynth(tickTime);\n    const synthRef = synth.current;\n    subscribeCSynth(synthRef);\n\n    const sequencer = new Nexus.Sequencer('#sequencer', {\n      rows: 24,\n      columns: 16\n    });\n    sequencer.on('change', ({ row, column, state }) => {\n      window.localStorage.setItem('chords', JSON.stringify(sequencer.matrix.pattern));\n      const freq = mtof(lowNote - row + 24);\n      if (state) {\n        synthRef.addNote({ index: column, freq });\n      } else {\n        synthRef.removeNote({ index: column, freq });\n      }\n    });\n    const localChords = window.localStorage.getItem('chords');\n    if (localChords) {\n      sequencer.matrix.set.all(JSON.parse(localChords));\n    }\n    synthRef.onTick = (pos) => {\n      sequencer.stepper.value = pos;\n      sequencer.next();\n    }\n  }, []);\n\n  // actual render code\n\n  console.log(useSetCallback(setAmp, 'attack'));\n  return (\n    <div className='App'>\n      <section id='amp-env'>\n        <h2>Amp Env</h2>\n        <div className='knob-row'>\n          <div className='knob'>\n            <Dial value={amp.attack}\n              onChange={useSetCallback(setAmp, 'attack')} />\n            Attack\n          </div>\n          <div className='knob' >\n            <Dial value={amp.decay}\n              onChange={useSetCallback(setAmp, 'decay')} />\n            Decay\n          </div>\n          <div className='knob' >\n            <Dial value={amp.sustain}\n              onChange={useSetCallback(setAmp, 'sustain')} />\n            Sustain\n          </div>\n          <div className='knob' >\n            <Dial value={amp.release}\n              onChange={useSetCallback(setAmp, 'release')} />\n            Release\n          </div>\n        </div>\n      </section>\n      <section id='filter-env'>\n        <h2>Filter</h2>\n        <div className='knob-row'>\n          <div className='knob'>\n            <Dial value={filter.attack}\n              onChange={useSetCallback(setFilter, 'attack')} />\n            Attack\n          </div>\n          <div className='knob'>\n            <Dial value={filter.decay}\n              onChange={useSetCallback(setFilter, 'decay')} />\n            Decay\n          </div>\n          <div className='knob'>\n            <Dial value={filter.sustain}\n              onChange={useSetCallback(setFilter, 'sustain')} />\n            Sustain\n          </div>\n          <div className='knob'>\n            <Dial value={filter.release}\n              onChange={useSetCallback(setFilter, 'release')} />\n            Release\n          </div>\n          <div className='knob'>\n            <Dial value={filter.base}\n              onChange={useSetCallback(setFilter, 'base')} />\n            Base\n          </div>\n          <div className='knob'>\n            <Dial value={filter.range}\n              onChange={useSetCallback(setFilter, 'range')} />\n            Range\n          </div>\n          <div className='knob'>\n            <Dial value={filter.q}\n              onChange={useSetCallback(setFilter, 'q')} />\n            Q\n          </div>\n        </div>\n      </section>\n      <form id='frequency-offset'>\n        <h3>Frequency Offset</h3>\n        <div>\n          {\n            frequencyOffsetValues.map(value => {\n              return <input type='radio'\n                name='frequency-offset'\n                value={value}\n                key={value}\n                checked={frequencyOffset === value}\n                onChange={handleClickFrequencyOffset}\n              />\n            })\n          }\n        </div>\n      </form>\n      <div id='sequencer' />\n      {/* <Dial value={1} onChange={v => console.log(v)} /> */}\n    </div>\n  );\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatch\n)(Synth1);\n"]},"metadata":{},"sourceType":"module"}